{"version":3,"sources":["../../app/src/app/view/editable-metadata.view.ts"],"names":[],"mappings":"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","file":"editable-metadata.view.js","sourcesContent":["import { \r\n    Component,\r\n    OnInit,\r\n    OnChanges,\r\n    Input,\r\n    Output,\r\n    EventEmitter,\r\n    ViewChild,\r\n    ElementRef\r\n} from '@angular/core';\r\n\r\nimport { Address } from '../../model/address';\r\n\r\nexport class DropdownOption {\r\n    [key:string]: any;\r\n\r\n    name: string;\r\n    _id: string;\r\n    icon?: string;\r\n    description?: string;\r\n}\r\n\r\n@Component({\r\n    moduleId: module.id,\r\n    selector: '.improvplus-editable-metadata',\r\n    templateUrl: '../template/view/editable-metadata.view.html'\r\n})\r\nexport class EditableMetadataView implements OnInit, OnChanges {\r\n\r\n    @ViewChild('metadataInput') inputElement: any;\r\n\r\n    @Input() icon: string; // an icon to show if necessary\r\n    @Input() text: string; // the text to show by default\r\n    @Input() model: string|DropdownOption; // pass an object if you want, this will try to use the name property if it exists\r\n    @Input() blankText: string; // the fallback text to show if there is no text\r\n    @Input() allowBlank: boolean = true;\r\n    @Input() canEdit: boolean; // whether the user can edit this thing\r\n\r\n    @Input() type: string; // 'text' 'address' or 'dropdown'\r\n\r\n    @Output() save: EventEmitter<any> = new EventEmitter(); // called when the item saves\r\n    @Output() saveAddress: EventEmitter<Address> = new EventEmitter(); // called when the address saves\r\n\r\n    editShown: boolean;\r\n\r\n    editModel: string;\r\n\r\n    // these properties are for address types\r\n    @Input() address: string;\r\n    @Input() city: string;\r\n    @Input() state: string;\r\n    @Input() zip: string;\r\n    @Input() country: string;\r\n\r\n    // for dropdowns, the items to show\r\n    @Input() options: DropdownOption[];\r\n    @Input() optionId: string = '_id'; // the property to use as the ID for each option\r\n    @Input() optionDescription: string = 'description'; // the property to use as the title attribute on each option\r\n    @Input() optionText: string = 'name'; // the property to use to get the text for each option\r\n    @Input() optionCreate: boolean = false; // whether to allow creating new dropdown options\r\n\r\n    @Output() createOption: EventEmitter<boolean> = new EventEmitter(); // should trigger a dialog or something to create a new option\r\n\r\n    private _defaultOptionSelected: boolean;\r\n\r\n    constructor(\r\n    ) { }\r\n\r\n    ngOnInit(): void {\r\n        if (!this.type) {\r\n            if (this.address) {\r\n                this.type = 'address';\r\n            } else if (this.options) {\r\n                this.type = 'dropdown';\r\n            } else {\r\n                this.type = 'text';\r\n            }\r\n        }\r\n\r\n        if (this.type == 'address') {\r\n            this.setupAddress();\r\n        }\r\n\r\n        if (this.type == 'dropdown' && !this.model) {\r\n            if (!this.allowBlank) {\r\n                // by default select the first option\r\n                this.model = this.options[0];\r\n                this._defaultOptionSelected = true;\r\n            }\r\n            this.setupDropdown();\r\n        }\r\n\r\n        if (!this.text && this.allowBlank) {\r\n            this.text = this.blankText;\r\n        }\r\n    }\r\n\r\n    setupDropdown(): void {\r\n        if (this.model && (<DropdownOption> this.model).name) {\r\n            this.text = (<DropdownOption> this.model).name;\r\n            this.icon = (<DropdownOption> this.model).icon;\r\n        } else if (!this.allowBlank) {\r\n            this.text = this.options[0].name;\r\n            this.icon = this.options[0].icon;\r\n        }\r\n    }\r\n\r\n    ngOnChanges(changes: any): void {\r\n        if (changes.model && this.model && this.text != (<DropdownOption> this.model).name && this.model.hasOwnProperty('name')) {\r\n            this.text = (<DropdownOption> this.model).name;\r\n\r\n            if (!this.icon && (<DropdownOption> this.model).icon) {\r\n                this.icon = (<DropdownOption> this.model).icon;\r\n            }\r\n        } else if (changes.options && changes.options.previousValue) {\r\n            if (this._defaultOptionSelected) {\r\n                this.model = this.options[0];\r\n            }\r\n            this.setupDropdown();\r\n        }\r\n    }\r\n\r\n    private _focusInput(): void {\r\n        if (this.inputElement) {\r\n            (<HTMLInputElement> this.inputElement.nativeElement).focus();\r\n        }\r\n    }\r\n\r\n    setupAddress(): void {\r\n        let address = this.address || '',\r\n            city = this.city || '',\r\n            state = this.state || '',\r\n            zip = this.zip || '',\r\n            country = this.country || '';\r\n\r\n        this.text = address;\r\n        if (address && (city || state || zip)) {\r\n            this.text += '<br />';\r\n        }\r\n        this.text += city + ' ' + state;\r\n        if ((city || state) && zip) {\r\n            this.text += ',';\r\n        }\r\n        this.text += ' ' + zip;\r\n        if (this.text && country) {\r\n            this.text += '<br />';\r\n        }\r\n        this.text += country;\r\n\r\n        this.text = this.text.trim();\r\n    }\r\n\r\n    showEdit(): void {\r\n        if (this.canEdit) {\r\n            if (this.model) {\r\n                this.editModel = this.optionId ? (<DropdownOption> this.model)[this.optionId] : this.text;\r\n            } else {\r\n                this.editModel = this.text\r\n            }\r\n\r\n            this.editShown = true;\r\n            setTimeout(() => {\r\n                this._focusInput();\r\n            })\r\n        }\r\n    }\r\n\r\n    closeEdit(): void {\r\n        this.editShown = false;\r\n        if (this.model) {\r\n            this.editModel = this.optionId ? (<DropdownOption> this.model)[this.optionId] : this.text;\r\n        } else {\r\n            this.editModel = this.text\r\n        }\r\n    }\r\n\r\n    pressEnter(): void {\r\n        (<HTMLInputElement> this.inputElement.nativeElement).blur();\r\n    }\r\n\r\n    saveEdit(): void {\r\n        if (this.type == 'address') {\r\n            this.setupAddress();\r\n            this.saveAddress.emit({\r\n                address: this.address,\r\n                city: this.city,\r\n                state: this.state,\r\n                zip: this.zip,\r\n                country: this.country\r\n            });\r\n        } else if (this.type == 'dropdown') {\r\n            if (this.editModel == '-1') {\r\n                // create a new thing!\r\n                this.text = '';\r\n                this.createOption.emit(true);\r\n            } else {\r\n                let selection: any;\r\n                if (this.optionId) {\r\n                    (<DropdownOption[]> this.options).forEach(option => {\r\n                        if (option[this.optionId] == this.editModel) {\r\n                            selection = option;\r\n                        }\r\n                    });\r\n                } else {\r\n                    selection = this.editModel;\r\n                }\r\n                this.text = this.optionText ? selection[this.optionText] : selection;\r\n                if (selection.icon) {\r\n                    this.icon = selection.icon;\r\n                }\r\n                this.model = selection;\r\n                this.save.emit(selection);\r\n            }\r\n        } else if (this.editModel && this.editModel != this.text) {\r\n            this.text = this.editModel;\r\n            this.save.emit(this.editModel);\r\n        }\r\n\r\n        this.closeEdit();\r\n    }\r\n}\r\n"]}