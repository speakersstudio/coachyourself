{"version":3,"sources":["../../app/src/app/component/game-database.component.ts"],"names":[],"mappings":"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","file":"game-database.component.js","sourcesContent":["import {\r\n    Component,\r\n    OnInit,\r\n    OnDestroy,\r\n    trigger,\r\n    state,\r\n    style,\r\n    transition,\r\n    animate\r\n} from '@angular/core';\r\nimport { PathLocationStrategy } from '@angular/common';\r\n\r\nimport { Router, ActivatedRoute, Params } from '@angular/router';\r\nimport 'rxjs/Subscription';\r\nimport { Subscription } from 'rxjs/Subscription';\r\n\r\nimport { AppComponent } from '../../component/app.component';\r\nimport { Tool, SearchResult } from '../view/toolbar.view';\r\n\r\nimport { GameDatabaseService } from '../service/game-database.service';\r\nimport { UserService } from \"../../service/user.service\";\r\n\r\nimport { Game } from '../../model/game';\r\nimport { Name } from '../../model/name';\r\nimport { Tag } from '../../model/tag';\r\n\r\nexport class GameFilter {\r\n    property: string;\r\n    value: string;\r\n}\r\n\r\n@Component({\r\n    moduleId: module.id,\r\n    selector: \"game-database\",\r\n    templateUrl: '../template/game-database.component.html',\r\n    animations: [\r\n        trigger('flyInOut', [\r\n            state('in',   style({\r\n                opacity: 1\r\n            })),\r\n            transition('void => *', [\r\n                style({opacity: 0}),\r\n                animate(100)\r\n            ]),\r\n            transition('* => void', [\r\n                animate(100, style({opacity: 0}))\r\n            ])\r\n        ])\r\n    ]\r\n})\r\nexport class GameDatabaseComponent implements OnInit, OnDestroy {\r\n    games: Game[] = [];\r\n    names: Name[] = [];\r\n    selectedGame: Game;\r\n\r\n    private _gameDisplayCount: number = 0;\r\n    allGamesAreDisplayed: boolean;\r\n\r\n    previousScrollPosition: number;\r\n\r\n    _titleBase: string = '<span class=\"light\">game</span><strong>database</strong>';\r\n    title: string;\r\n\r\n    searchResults: SearchResult[] = [];\r\n    filter: GameFilter;\r\n    searchTerm: string;\r\n\r\n    isLoadingGames: boolean;\r\n\r\n    constructor(\r\n        private _app: AppComponent,\r\n        private route: ActivatedRoute,\r\n        private router: Router,\r\n        private gameDatabaseService: GameDatabaseService,\r\n        private pathLocationStrategy: PathLocationStrategy,\r\n        public userService: UserService\r\n    ) { }\r\n\r\n    private tools: Tool[] = [\r\n        {\r\n            icon: \"fa-random\",\r\n            name: \"randomGame\",\r\n            text: \"Select Random Game\",\r\n            active: false\r\n        }\r\n    ];\r\n\r\n    ngOnInit(): void {\r\n\r\n        this.setTitle();\r\n\r\n        this._app.showLoader();\r\n        this._app.showBackground(true);\r\n        this.getGames();\r\n\r\n        this.pathLocationStrategy.onPopState(() => {\r\n            this.selectedGame = null;\r\n            this._app.showBackground(true);\r\n        });\r\n\r\n    }\r\n\r\n    setTitle(): void {\r\n        if (this.filter) {\r\n            this.title = \"back\";\r\n        } else {\r\n            this.title = this._titleBase;\r\n        }\r\n    }\r\n\r\n    getGames(): void {\r\n        this.gameDatabaseService.getGames().then(games => {\r\n            games = this._filterGames(games);\r\n            this._loadGames(games);\r\n        });\r\n    }\r\n\r\n    getGamesSearch(term: string): void {\r\n        //this._setPath(\"/games;search=\" + term);\r\n        this.gameDatabaseService.searchForGames(term).then(games => this._loadGames(games))\r\n    }\r\n\r\n    loadMoreGames(page: number): void {\r\n        if (!this.allGamesAreDisplayed) {\r\n            this.isLoadingGames = true;\r\n            this._gameDisplayCount = 30 * page;\r\n            this.getGames();\r\n        }\r\n    }\r\n\r\n    private _loadGames(games: Game[]): void {\r\n        setTimeout(() => {\r\n            this._app.hideLoader();\r\n            this.isLoadingGames = false;\r\n\r\n            if (games.length > this._gameDisplayCount) {\r\n                this.games = games.slice(0, this._gameDisplayCount);\r\n            } else {\r\n                this.games = games;\r\n                this.allGamesAreDisplayed = true;\r\n            }\r\n            this.onGamesLoaded();\r\n        }, 150);\r\n    }\r\n\r\n    private _filterGames(games: Game[]): Game[] {\r\n        if (this.filter) {\r\n            //this._setPath(\"/games;filter=\" + this.filter.property + \",value=\" + this.filter.value);\r\n            return games.filter((game) => {\r\n                // don't show things without names if we can't edit them\r\n                if (!game.names.length && !this.userService.can('game_edit')) {\r\n                    return false;\r\n                }\r\n                if (this.filter.property == 'TagID') {\r\n                    for (var tagIDIndex = 0; tagIDIndex < game.tags.length; tagIDIndex++) {\r\n                        if ((<Tag> game.tags[tagIDIndex])._id == this.filter.value) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                    return false;\r\n                } else if (game[this.filter.property] && game[this.filter.property]._id) {\r\n                    return game[this.filter.property]._id == this.filter.value;\r\n                } else {\r\n                    return game[this.filter.property] == this.filter.value;\r\n                }\r\n            });\r\n        } else {\r\n            return games;\r\n        }\r\n    }\r\n\r\n    onGamesLoaded(): void {\r\n        // navigate to games;random=random to load a random game\r\n        this.route.params.forEach((params: Params) => {\r\n            if (params['random']) {\r\n                this.pathLocationStrategy.replaceState({}, \"\", \"/app/games\", \"\");\r\n                this.selectRandomGame();\r\n            }\r\n        })\r\n    }\r\n\r\n    trackByGames(index: number, game: Game) {\r\n        return game._id;\r\n    }\r\n\r\n    onSelect(game: Game): void {\r\n        // remember the scroll position so we can return there when the user comes back\r\n        if (!this.selectedGame) {\r\n            this.previousScrollPosition = window.scrollY;\r\n        }\r\n\r\n        this._app.showBackground(false);\r\n\r\n        if (!game) {\r\n            this.selectedGame = null;\r\n        } else {\r\n            this.selectedGame = game;\r\n        }\r\n    \r\n        let newPath = \"/app/game/\" + this.selectedGame._id;\r\n        this._app.setPath(newPath);\r\n\r\n        window.scrollTo(0, 0);\r\n    }\r\n\r\n    // private _setPath(path: string): void {\r\n    //     if (this.pathLocationStrategy.path().indexOf(\"/game/\") > -1) {\r\n    //         this.pathLocationStrategy.replaceState({}, \"\", path, \"\");\r\n    //     } else {\r\n    //         this.pathLocationStrategy.pushState({}, \"\", path, \"\");\r\n    //     }\r\n    // }\r\n\r\n    selectRandomGame(): void {\r\n        // reload the games, because we don't want to limit ourselves by just what has been loaded by the infinite scroll\r\n        this.gameDatabaseService.getGames().then(games => {\r\n            games = this._filterGames(games);\r\n\r\n            let i = Math.floor((Math.random() * games.length));\r\n            this.onSelect(games[i]);\r\n        });\r\n    }\r\n\r\n    closeDetails(tool: Tool): void {\r\n        if (tool && tool.name) {\r\n            this.onToolClicked(tool);\r\n        } else {\r\n            this._goBack();\r\n\r\n            setTimeout(() => {\r\n                window.scrollTo(0, this.previousScrollPosition);\r\n                this.previousScrollPosition = 0;\r\n            }, 10);\r\n        }\r\n    }\r\n\r\n    onToolClicked(tool: Tool): void {\r\n        switch (tool.name) {\r\n            case \"showTags\":\r\n                tool.active = !tool.active;\r\n                break;\r\n            case \"randomGame\":\r\n                this.selectRandomGame();\r\n                break;\r\n        }\r\n    }\r\n\r\n    ngOnDestroy(): void {\r\n    }\r\n\r\n    onSearchResultClick(result: SearchResult): void {\r\n        console.log(result);\r\n        switch(result.type) {\r\n            case 'search':\r\n                if (result.text) {\r\n                    this.filter = {\r\n                        \"property\": \"search\",\r\n                        \"value\" : \"\"\r\n                    }\r\n                    this.searchTerm = result.text;\r\n                    this.getGamesSearch(result.text);\r\n                    this.setTitle();\r\n                } else {\r\n                    //this._goBack();\r\n                    this.clearFilter();\r\n                }\r\n                return;\r\n            case 'name':\r\n                this.gameDatabaseService.getGame(result.id)\r\n                    .then((game) => this.onSelect(game));\r\n                return;\r\n            case 'tag':\r\n                this.filter = {\r\n                    \"property\": 'TagID',\r\n                    \"value\": result.id\r\n                }\r\n                break;\r\n            case 'duration':\r\n                this.filter = {\r\n                    \"property\": 'duration',\r\n                    \"value\": result.id\r\n                }\r\n                break;\r\n            case 'playercount':\r\n                this.filter = {\r\n                    \"property\": 'playerCount',\r\n                    \"value\": result.id\r\n                }\r\n                break;\r\n        }\r\n        this.getGames();\r\n        this.setTitle();\r\n    }\r\n\r\n    onSearch(term: string): void {\r\n        this.gameDatabaseService.searchForResults(term)\r\n            .then((results) => this.searchResults = results);\r\n    }\r\n\r\n    private _goBack(): void {\r\n        this.pathLocationStrategy.back();\r\n    }\r\n\r\n    clearFilter(): void {\r\n        // TODO: back button should clear filters\r\n        this.filter = null;\r\n        this.getGames();\r\n        this.setTitle();\r\n    }\r\n\r\n    createGame(): void {\r\n        if (this.userService.can('game_create')) {\r\n            this.gameDatabaseService.createGame()\r\n                .then(game => {\r\n                    this.onSelect(game);\r\n                });\r\n        }\r\n    }\r\n\r\n}\r\n"]}