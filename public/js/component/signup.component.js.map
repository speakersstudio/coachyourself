{"version":3,"sources":["../../app/src/component/signup.component.ts"],"names":[],"mappings":"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","file":"signup.component.js","sourcesContent":["import { \r\n    Component,\r\n    OnInit,\r\n    ViewChild,\r\n    ViewChildren,\r\n    QueryList,\r\n    ElementRef\r\n} from '@angular/core';\r\nimport { Router } from '@angular/router';\r\n\r\nimport { AppComponent } from './app.component';\r\nimport { AppService } from '../service/app.service';\r\nimport { UserService } from '../service/user.service';\r\nimport { StripeService } from '../service/stripe.service';\r\n\r\nimport { User } from '../model/user';\r\nimport { Package } from '../model/package';\r\n\r\nimport { ShrinkAnim, DialogAnim } from '../util/anim.util';\r\n\r\nimport { BracketCardDirective } from '../directive/bracket-card.directive';\r\n\r\ndeclare var Stripe: any;\r\n\r\n@Component({\r\n    moduleId: module.id,\r\n    selector: \"signup\",\r\n    templateUrl: '../template/signup.component.html',\r\n    animations: [\r\n        DialogAnim.dialog,\r\n        ShrinkAnim.height\r\n    ]\r\n})\r\nexport class SignupComponent implements OnInit {\r\n    [key:string]: any;\r\n\r\n    packages: Package[] = [];\r\n\r\n    email: string;\r\n    password: string;\r\n    userName: string;\r\n    title: string;\r\n    company: string;\r\n    country: string = 'United States';\r\n\r\n    isPosting: boolean = false;\r\n\r\n    creditCard: any;\r\n\r\n    emailError: string;\r\n    cardError: string;\r\n\r\n    cardComplete: boolean = false;\r\n\r\n    termsDialogVisible: boolean;\r\n    termsAccepted: boolean;\r\n\r\n    constructor(\r\n        public _app: AppComponent,\r\n        private _service: AppService,\r\n        private router: Router,\r\n        private userService: UserService,\r\n        private stripeService: StripeService\r\n    ) { }\r\n\r\n    ngOnInit(): void {\r\n\r\n        if (this.userService.isLoggedIn()) {\r\n            this.router.navigate(['dashboard'], {replaceUrl: true});\r\n            return;\r\n        }\r\n\r\n        this._service.getPackages().then(packages => {\r\n            this.packages = packages;\r\n            this.setup();\r\n        });\r\n\r\n    }\r\n\r\n    setup(): void {\r\n\r\n        this.creditCard = this.stripeService.setupStripe(e => {\r\n            this.cardComplete = e.complete;\r\n\r\n            if (e.error) {\r\n                this.cardError = e.error.message;\r\n            } else {\r\n                this.cardError = '';\r\n            }\r\n        });\r\n\r\n        this.creditCard.mount('#card-element');\r\n\r\n    }\r\n\r\n    emailTimer: any;\r\n    emailInput(): void {\r\n        clearTimeout(this.emailTimer);\r\n\r\n        this.emailError = '';\r\n        this.emailValidating = true;\r\n        this.emailTimer = setTimeout(() => {\r\n            this.validateEmail();\r\n        }, 1000);\r\n    }\r\n\r\n    validateEmail(): void {\r\n        let user = new User();\r\n\r\n        if (this.email.indexOf('@') > -1 && this.email.indexOf('.') > -1) {\r\n            user.email = this.email;\r\n            this._service.validateUser(user).then(message => {\r\n                this.emailError = message;\r\n                this.emailValidating = false;\r\n            });\r\n        } else if (this.email.length > 0) {\r\n            this.emailError = 'This does not seem to be a valid email address.';\r\n            this.emailValidating = false;\r\n        } else {\r\n            this.emailError = '';\r\n            this.emailValidating = false;\r\n        }\r\n    }\r\n\r\n    isFormValid(): boolean {\r\n        return !this.emailValidating && !!this.email && !!!this.emailError && !!this.password && !!!this.cardError && this.cardComplete; // !!!!!\r\n    }\r\n\r\n    submitPayment(): void {\r\n        if (!this.isFormValid()) {\r\n            return;\r\n        }\r\n\r\n        if (!this.cardComplete) {\r\n            return;\r\n        }\r\n\r\n        this.isPosting = true;\r\n\r\n        this.stripeService.getStripeToken(this.creditCard).then((result: any) => {\r\n            if (result.error) {\r\n                this.cardError = result.error.message;\r\n            } else {\r\n                this._signup(result.token);\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    private _signup(token?: any): void {\r\n        let user = new User();\r\n        user.email = this.email;\r\n        user.password = this.password;\r\n        user.firstName = (this.userName + ' ').split(' ')[0];\r\n        user.lastName = (this.userName + ' ').split(' ')[0];\r\n        user.title = this.title;\r\n        user.company = this.company;\r\n        user.country = this.country;\r\n\r\n        this._service.signup(user, token)\r\n            .then(user => {\r\n                this._app.hideLoader();\r\n                if (user && user.email) {\r\n                    return this.userService.login(this.email, this.password);\r\n                } else {\r\n                    // uh oh?\r\n                    this._app.toast(\"Something bad happened. I'm not sure what to tell you.\");\r\n                }\r\n            }, response => {\r\n                this._app.hideLoader();\r\n                this.isPosting = false;\r\n                let msg = response.json();\r\n                this._handleError(msg);\r\n            });\r\n    }\r\n\r\n    private _handleError(msg: any): void {\r\n        if (msg.error && msg.error == 'email already exists') {\r\n            this.emailError = \"That email address is already registered.\";\r\n        } else if (msg.error) {\r\n            this._app.dialog('An error has occurred.', 'We are so sorry. Something happened, and we can\\'t be sure what. Please try again, and if this keeps happening, reach out to us by contacting awesomedesk@thespeakers-studio.com.', 'Okay bye', null, true);\r\n        }\r\n    }\r\n\r\n    showTerms(): void {\r\n        this._app.backdrop(true);\r\n        this.termsDialogVisible = true;\r\n    }\r\n\r\n    hideTerms(): void {\r\n        this._app.backdrop(false);\r\n        this.termsDialogVisible = false;\r\n    }\r\n\r\n}\r\n"]}